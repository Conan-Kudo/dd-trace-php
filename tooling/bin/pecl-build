#!/usr/bin/env bash

set -e

rm -f ./bridge/_generated.php
composer compile

# PECL doesn't like the "-nightly" part of the nightly version number so we have to change it
dd_version=$(cat src/DDTrace/Tracer.php | grep 'const VERSION' | awk '{print $$4}' | cut -d\' -f2 | sed 's/-nightly//g')

sed -e "s/\${version}/${dd_version}/g" -e "s/\${date}/$(date +%Y-%m-%d)/g" -i package.xml

pear package-validate package.xml
pear package
